<%
  TYPES = [
    'integer',
    'integer(8)',
    'real',
    'double precision',
    'complex',
    'complex(kind(0.0d0))',
    'logical',
  ]

  class String
    def fort_suf
      work = self.gsub(/[^\w]/, '_')
      work = 'type_' + work unless work[0] =~ /[A-Za-z]/
      '_' + work
    end
  end
%>
module lib_character
  implicit none
  private
  public:: str, STR_LEN
  integer, parameter:: STR_LEN = 256

  interface str
    <% TYPES.each{|type| %>
      module procedure str<%= type.fort_suf %>
    <% } %>
  end interface
  
contains

  <% TYPES.each{|type| %>
    elemental function str<%= type.fort_suf %>(x) result(this)
       character(len = STR_LEN):: this
       <%= type %>, intent(in):: x
       integer:: n
       write(this, *) x
       this = trim(adjustl(this))
    end function str<%= type.fort_suf %>
  <% } %>
end module lib_character
