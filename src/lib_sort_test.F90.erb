<%-
def enlarge(sml_n, scale)
  sml_n\
    .map{|array| array\
      .map{|n| n*scale}}\
    .map{|array| [array, array.sort]}
end

SCALE_I = 2**31 - 1
SCALE_F = 3.402823E+38

SML = [-1, 0, 1]
SML_SETS = [
  SML.product(SML),
  SML.product(SML, SML),
  SML.product(SML, SML, SML),
  SML.product(SML, SML, SML, SML),
]
-%>

#include "utils.h"
program lib_sort_test
  USE_UTILS_H
  use, intrinsic:: iso_fortran_env, only: OUTPUT_UNIT
  use lib_comparable, only: equivalent
  use lib_sort

  implicit none

  Integer:: i

  ! size 0
  test(size(qsort([(i, i = 1, 0)])) == 0)
  test(size(qsort([(dble(i), i = 1, 0)])) == 0)

  ! size 1
  test(all(qsort([0]) == [0]))
  test(all(equivalent(qsort([0.0]), [0.0])))

  <%- SML_SETS.each{|sml_set| -%>
    <%- enlarge(sml_set, SCALE_I).each{|input, sorted| -%>
      test(all(qsort(<%= input.inspect %>) == <%= sorted.inspect %>))
    <%- } -%>

    <%- enlarge(sml_set, SCALE_F).each{|input, sorted| -%>
      test(all(equivalent(qsort(<%= input.inspect %>), <%= sorted.inspect %>)))
    <%- } -%>
  <%- } -%>

  <%- 1.times{|i| -%>
    <%- randoms = (0...250000).map{rand} -%>
    <%- sorted = randoms.sort -%>
    test(all(equivalent(qsort(<%= randoms.inspect %>), <%= sorted.inspect %>)))
  <% } %>

  ! Bug check
  test(all(equivalent(qsort([0.992602646, 0.992602706]), [0.992602646, 0.992602706])))

  write(OUTPUT_UNIT, *) 'SUCCESS: ', __FILE__
  stop
end program lib_sort_test
