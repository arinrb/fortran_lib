<%
  require 'fort'

  TYPES\
  = ::Fort::Type::Logical.multi_provide\
  + ::Fort::Type::Integer.multi_provide\
  + ::Fort::Type::Real.multi_provide\
  + ::Fort::Type::Complex.multi_provide\
  + ::Fort::Type::Character.multi_provide
%>

module lib_reflectable
  <%= ::Fort::Type::USE_ISO_FORTRAN_ENV %>

  implicit none

  private

  public:: str_from_type_of
  public:: dim_from_type_of
  public:: stem_from_type_of

  <%- TYPES.each{|t| -%>
    interface str_from_type_of
      module procedure str_from_type_of<%= t %>
    end interface str_from_type_of

    interface dim_from_type_of
      module procedure dim_from_type_of<%= t %>
    end interface dim_from_type_of

    interface stem_from_type_of
      module procedure stem_from_type_of<%= t %>
    end interface stem_from_type_of
  <%- } -%>

contains

  <%- TYPES.each{|t| -%>
    function str_from_type_of<%= t %>(v) result(this)
      character(len = *), parameter:: STRING_EXPRESSION = "<%= t %>"
      character(len = len(STRING_EXPRESSION)):: this
      <%= t.declare %>, intent(in):: v

      this = STRING_EXPRESSION
    end function str_from_type_of<%= t %>

    function dim_from_type_of<%= t %>(v) result(this)
      integer, parameter:: DIM = <%= t.dim %>
      integer:: this
      <%= t.declare %>, intent(in):: v

      this = DIM
    end function dim_from_type_of<%= t %>

    function stem_from_type_of<%= t %>(v) result(this)
      character(len = *), parameter:: STEM = "<%= t.type %>"
      character(len = len(STEM)):: this
      <%= t.declare %>, intent(in):: v

      this = STEM
    end function stem_from_type_of<%= t %>
  <%- } -%>
end module lib_reflectable
